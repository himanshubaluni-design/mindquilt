<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <link rel="icon" href="logo.svg" type="image/svg+xml" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Dashboard ‚Äî MindQuilt</title>
    <meta name="description" content="Your personal MindQuilt dashboard ‚Äî sessions, saved articles, and account settings." />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,400;9..40,500;9..40,600;9..40,700&family=DM+Serif+Display&display=swap" rel="stylesheet" />
    <style>
        :root {
            --sage: #8FAF8F;
            --sage-dark: #4d7a4d;
            --sage-mid: #6e936e;
            --sage-light: #C8DCC8;
            --sage-bg: #EDF4ED;
            --sage-pale: #f4f9f4;
            --off-white: #F9F7F4;
            --charcoal: #2D2D2D;
            --clay: #C4826A;
            --clay-dark: #a86850;
            --clay-bg: #fdf0eb;
            --white: #FFFFFF;
            --muted: #6b7b6b;
            --radius: 12px;
            --max-w: 1100px;
            --font-head: 'DM Serif Display', serif;
            --font-body: 'DM Sans', sans-serif;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.05);
            --shadow-md: 0 6px 24px rgba(0,0,0,0.08);
        }
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body { font-family: var(--font-body); background: var(--off-white); color: var(--charcoal); line-height: 1.7; min-height: 100vh; padding-bottom: 72px; }
        a { color: inherit; text-decoration: none; }

        /* Loading screen */
        #loading-screen {
            position: fixed; inset: 0; background: var(--off-white);
            display: flex; align-items: center; justify-content: center;
            z-index: 999; flex-direction: column; gap: 16px;
        }
        .spinner {
            width: 40px; height: 40px; border: 3px solid var(--sage-bg);
            border-top-color: var(--sage); border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        #loading-screen p { font-size: 0.88rem; color: var(--muted); }

        /* Nav */
        nav { background: var(--white); border-bottom: 1px solid #e6ede6; position: sticky; top: 0; z-index: 100; }
        .nav-inner { max-width: var(--max-w); margin: 0 auto; padding: 0 24px; height: 62px; display: flex; align-items: center; justify-content: space-between; }
        .nav-logo { font-family: var(--font-head); font-size: 1.35rem; display: flex; align-items: center; gap: 8px; }
        .nav-right { display: flex; align-items: center; gap: 16px; }
        .nav-avatar { width: 36px; height: 36px; border-radius: 50%; background: var(--sage-bg); border: 2px solid var(--sage-light); display: flex; align-items: center; justify-content: center; font-size: 0.85rem; font-weight: 700; color: var(--sage-dark); cursor: pointer; }
        .nav-email { font-size: 0.82rem; color: var(--muted); display: none; }
        @media (min-width: 600px) { .nav-email { display: block; } }
        .btn-logout { background: none; border: 1px solid #dce8dc; border-radius: 8px; padding: 7px 14px; font-size: 0.82rem; font-weight: 600; color: var(--muted); cursor: pointer; font-family: var(--font-body); transition: border-color 0.2s, color 0.2s; }
        .btn-logout:hover { border-color: #c84a3a; color: #c84a3a; }

        /* Premium badge */
        .premium-badge { display: inline-flex; align-items: center; gap: 5px; background: linear-gradient(135deg, #f9e8c4, #f5d6a0); color: #8a5c00; border-radius: 20px; padding: 3px 12px; font-size: 0.75rem; font-weight: 700; letter-spacing: 0.03em; }

        /* Page layout */
        .page-wrap { max-width: var(--max-w); margin: 0 auto; padding: 36px 24px; }

        /* Welcome strip */
        .welcome-strip { background: linear-gradient(135deg, var(--sage-bg) 0%, #dff0df 100%); border-radius: 16px; padding: 28px 32px; display: flex; align-items: center; justify-content: space-between; gap: 20px; margin-bottom: 36px; flex-wrap: wrap; }
        .welcome-strip h1 { font-family: var(--font-head); font-size: 1.8rem; line-height: 1.25; margin-bottom: 6px; }
        .welcome-strip p { font-size: 0.9rem; color: var(--muted); }
        .welcome-actions { display: flex; gap: 10px; flex-shrink: 0; flex-wrap: wrap; }
        .btn-sm { padding: 9px 20px; border-radius: 10px; font-size: 0.85rem; font-weight: 600; font-family: var(--font-body); cursor: pointer; transition: all 0.2s; border: none; }
        .btn-sage { background: var(--sage); color: var(--white); }
        .btn-sage:hover { background: var(--sage-mid); }
        .btn-outline { background: none; border: 1.5px solid var(--sage); color: var(--sage-dark); }
        .btn-outline:hover { background: var(--sage-bg); }

        /* Dashboard grid */
        .dash-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
        @media (max-width: 780px) { .dash-grid { grid-template-columns: 1fr; } }
        .dash-grid .full-width { grid-column: 1 / -1; }

        /* Cards */
        .card { background: var(--white); border-radius: 16px; box-shadow: var(--shadow-sm); padding: 28px; }
        .card-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
        .card-title { font-family: var(--font-head); font-size: 1.1rem; color: var(--charcoal); }
        .card-link { font-size: 0.8rem; color: var(--sage-mid); font-weight: 600; }
        .card-link:hover { color: var(--sage-dark); }

        /* Stats row */
        .stats-row { display: flex; gap: 16px; flex-wrap: wrap; margin-bottom: 28px; }
        .stat-chip { background: var(--sage-bg); border-radius: 12px; padding: 14px 20px; flex: 1; min-width: 120px; text-align: center; }
        .stat-chip .num { font-family: var(--font-head); font-size: 1.8rem; color: var(--sage-dark); line-height: 1; }
        .stat-chip .label { font-size: 0.75rem; color: var(--muted); margin-top: 4px; }
        .stat-chip.clay { background: var(--clay-bg); }
        .stat-chip.clay .num { color: var(--clay-dark); }

        /* Session cards */
        .session-list { display: flex; flex-direction: column; gap: 14px; }
        .session-item { display: flex; align-items: center; gap: 16px; padding: 14px 18px; border: 1px solid #edf4ed; border-radius: 12px; transition: box-shadow 0.2s; }
        .session-item:hover { box-shadow: var(--shadow-sm); }
        .session-avatar { width: 44px; height: 44px; border-radius: 12px; background: var(--sage-bg); display: flex; align-items: center; justify-content: center; font-size: 1.4rem; flex-shrink: 0; }
        .session-info { flex: 1; }
        .session-info .s-name { font-weight: 600; font-size: 0.9rem; }
        .session-info .s-meta { font-size: 0.78rem; color: var(--muted); margin-top: 2px; }
        .session-badge { font-size: 0.72rem; font-weight: 600; padding: 3px 10px; border-radius: 20px; white-space: nowrap; }
        .badge-upcoming { background: #e8f5e8; color: #2e7d32; }
        .badge-completed { background: #f3f3f3; color: #777; }
        .session-empty { text-align: center; padding: 32px 20px; color: var(--muted); font-size: 0.88rem; }
        .session-empty .e-icon { font-size: 2rem; margin-bottom: 10px; }
        .session-empty .e-cta { display: inline-block; margin-top: 14px; padding: 9px 20px; background: var(--clay); color: var(--white); border-radius: 10px; font-size: 0.85rem; font-weight: 600; transition: background 0.2s; }
        .session-empty .e-cta:hover { background: var(--clay-dark); }

        /* Saved articles */
        .article-list { display: flex; flex-direction: column; gap: 12px; }
        .article-item { display: flex; align-items: flex-start; gap: 14px; padding: 12px 14px; border: 1px solid #edf4ed; border-radius: 12px; transition: box-shadow 0.2s; cursor: pointer; }
        .article-item:hover { box-shadow: var(--shadow-sm); border-color: var(--sage-light); }
        .article-tag { display: inline-block; font-size: 0.7rem; font-weight: 600; padding: 2px 8px; border-radius: 20px; background: var(--sage-bg); color: var(--sage-dark); white-space: nowrap; margin-top: 4px; }
        .article-item h4 { font-size: 0.88rem; font-weight: 600; line-height: 1.4; margin-bottom: 3px; }
        .article-item p { font-size: 0.78rem; color: var(--muted); line-height: 1.5; }
        .article-unsave { background: none; border: none; color: var(--muted); cursor: pointer; padding: 4px; font-size: 1rem; transition: color 0.2s; flex-shrink: 0; }
        .article-unsave:hover { color: #c84a3a; }
        .article-loading { text-align: center; padding: 24px; color: var(--muted); font-size: 0.85rem; }
        .no-articles { text-align: center; padding: 28px 16px; color: var(--muted); font-size: 0.85rem; }
        .no-articles .na-icon { font-size: 1.8rem; margin-bottom: 8px; }

        /* Premium feature card */
        .premium-card { background: linear-gradient(135deg, #2d2d2d 0%, #1a3320 100%); color: var(--white); border-radius: 16px; padding: 28px 32px; }
        .premium-card .card-title { color: var(--white); margin-bottom: 6px; }
        .premium-card p { font-size: 0.88rem; color: rgba(255,255,255,0.7); margin-bottom: 20px; }
        .feature-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        @media (max-width: 480px) { .feature-grid { grid-template-columns: 1fr; } }
        .feature-item { background: rgba(255,255,255,0.08); border-radius: 10px; padding: 14px 16px; }
        .feature-item .fi-icon { font-size: 1.4rem; margin-bottom: 6px; }
        .feature-item h5 { font-size: 0.85rem; font-weight: 600; color: var(--white); margin-bottom: 3px; }
        .feature-item p { font-size: 0.75rem; color: rgba(255,255,255,0.6); margin: 0; }

        /* Account settings */
        .settings-form { display: flex; flex-direction: column; gap: 18px; }
        .form-group { display: flex; flex-direction: column; gap: 5px; }
        .form-group label { font-size: 0.78rem; font-weight: 600; color: var(--charcoal); }
        .form-input { padding: 10px 14px; border: 1.5px solid #dce8dc; border-radius: 10px; font-size: 0.88rem; font-family: var(--font-body); background: var(--off-white); color: var(--charcoal); transition: border-color 0.2s; }
        .form-input:focus { outline: none; border-color: var(--sage); background: var(--white); }
        .form-input[readonly] { background: #f0f4f0; cursor: not-allowed; color: var(--muted); }
        .btn-save { padding: 10px 24px; background: var(--sage); color: var(--white); border: none; border-radius: 10px; font-size: 0.85rem; font-weight: 600; font-family: var(--font-body); cursor: pointer; transition: background 0.2s; align-self: flex-start; }
        .btn-save:hover { background: var(--sage-mid); }
        .settings-divider { border: none; border-top: 1px solid #edf4ed; margin: 4px 0; }

        /* Toast */
        .toast { position: fixed; top: 24px; left: 50%; transform: translateX(-50%) translateY(-100px); background: var(--sage-dark); color: var(--white); padding: 12px 24px; border-radius: 12px; font-size: 0.85rem; font-weight: 500; box-shadow: 0 8px 32px rgba(0,0,0,0.15); z-index: 9000; transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); white-space: nowrap; }
        .toast.show { transform: translateX(-50%) translateY(0); }
        .toast.error { background: #b03a2e; }

        /* Crisis banner */
        .crisis-banner { background: #2D2D2D; color: #fff; text-align: center; padding: 9px 20px; font-size: 0.82rem; position: fixed; bottom: 0; left: 0; right: 0; z-index: 500; }
        .crisis-banner a { color: #b5d3b5; text-decoration: underline; font-weight: 600; }
    </style>
</head>
<body>

    <!-- Loading screen (shown until auth check completes) -->
    <div id="loading-screen">
        <div class="spinner"></div>
        <p>Loading your dashboard...</p>
    </div>

    <!-- Nav -->
    <nav>
        <div class="nav-inner">
            <a href="index.html" class="nav-logo">
                <img src="logo.svg" alt="MindQuilt" height="28" />
                MindQuilt
            </a>
            <div class="nav-right">
                <span class="nav-email" id="nav-email"></span>
                <div class="nav-avatar" id="nav-avatar">?</div>
                <button class="btn-logout" id="logout-btn">Sign Out</button>
            </div>
        </div>
    </nav>

    <div class="page-wrap">

        <!-- Welcome strip -->
        <div class="welcome-strip">
            <div>
                <div style="margin-bottom:8px;">
                    <span class="premium-badge">‚≠ê Premium Member</span>
                </div>
                <h1>Welcome back, <span id="user-name">there</span> üëã</h1>
                <p>Here's everything in one place ‚Äî your sessions, saved reading, and settings.</p>
            </div>
            <div class="welcome-actions">
                <a href="experts.html" class="btn-sm btn-clay" style="background:var(--clay);color:#fff;padding:9px 20px;border-radius:10px;font-size:0.85rem;font-weight:600;display:inline-block;">Book a Session</a>
                <a href="blog.html" class="btn-sm btn-outline" style="background:none;border:1.5px solid var(--sage);color:var(--sage-dark);padding:9px 20px;border-radius:10px;font-size:0.85rem;font-weight:600;display:inline-block;">Browse Articles</a>
            </div>
        </div>

        <!-- Stats row -->
        <div class="stats-row" style="margin-bottom:28px;">
            <div class="stat-chip">
                <div class="num" id="stat-sessions">0</div>
                <div class="label">Sessions Booked</div>
            </div>
            <div class="stat-chip">
                <div class="num" id="stat-saved">0</div>
                <div class="label">Saved Articles</div>
            </div>
            <div class="stat-chip clay">
                <div class="num">‚àû</div>
                <div class="label">Article Access</div>
            </div>
            <div class="stat-chip clay">
                <div class="num">24/7</div>
                <div class="label">Crisis Support</div>
            </div>
        </div>

        <div class="dash-grid">

            <!-- Upcoming Sessions -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">Upcoming Sessions</span>
                    <a href="experts.html" class="card-link">Find an expert ‚Üí</a>
                </div>
                <div class="session-list" id="session-list">
                    <!-- Placeholder sessions shown to demo the UI -->
                    <div class="session-item">
                        <div class="session-avatar">üß†</div>
                        <div class="session-info">
                            <div class="s-name">Dr. Priya Sharma</div>
                            <div class="s-meta">Anxiety &amp; Stress ¬∑ Mon 10 Mar, 3:00 PM</div>
                        </div>
                        <span class="session-badge badge-upcoming">Upcoming</span>
                    </div>
                    <div class="session-item">
                        <div class="session-avatar">üíº</div>
                        <div class="session-info">
                            <div class="s-name">James Okafor, LPC</div>
                            <div class="s-meta">Work &amp; Burnout ¬∑ Fri 14 Feb, 5:30 PM</div>
                        </div>
                        <span class="session-badge badge-completed">Completed</span>
                    </div>
                    <div class="session-item">
                        <div class="session-avatar">üåø</div>
                        <div class="session-info">
                            <div class="s-name">Dr. Anika Reyes</div>
                            <div class="s-meta">CBT &amp; Mindfulness ¬∑ Wed 21 Jan, 11:00 AM</div>
                        </div>
                        <span class="session-badge badge-completed">Completed</span>
                    </div>
                </div>
            </div>

            <!-- Saved Articles -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">Saved Articles</span>
                    <a href="blog.html" class="card-link">Browse all ‚Üí</a>
                </div>
                <div id="saved-articles-container">
                    <div class="article-loading">Loading your saved articles...</div>
                </div>
            </div>

            <!-- Premium Features -->
            <div class="premium-card full-width">
                <div style="display:flex;align-items:center;gap:12px;margin-bottom:6px;">
                    <span class="card-title">Your Premium Benefits</span>
                    <span class="premium-badge">‚≠ê Active</span>
                </div>
                <p>Everything included in your MindQuilt Premium membership.</p>
                <div class="feature-grid">
                    <div class="feature-item">
                        <div class="fi-icon">üìñ</div>
                        <h5>Unlimited Articles</h5>
                        <p>Full access to all mental health articles, guides, and deep-dives.</p>
                    </div>
                    <div class="feature-item">
                        <div class="fi-icon">üë©‚Äç‚öïÔ∏è</div>
                        <h5>Expert Directory</h5>
                        <p>Browse and book sessions with all verified licensed professionals.</p>
                    </div>
                    <div class="feature-item">
                        <div class="fi-icon">üîñ</div>
                        <h5>Reading List</h5>
                        <p>Save articles and come back to them anytime from any device.</p>
                    </div>
                    <div class="feature-item">
                        <div class="fi-icon">üÜò</div>
                        <h5>24/7 Crisis Access</h5>
                        <p>Direct links to crisis lines and support resources, always available.</p>
                    </div>
                </div>
            </div>

            <!-- Account Settings -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">Account Settings</span>
                </div>
                <form class="settings-form" id="settings-form">
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" class="form-input" id="setting-name" placeholder="Your full name" />
                    </div>
                    <div class="form-group">
                        <label>Email Address</label>
                        <input type="email" class="form-input" id="setting-email" readonly />
                    </div>
                    <button type="submit" class="btn-save">Save Changes</button>

                    <hr class="settings-divider" />

                    <div class="form-group">
                        <label>New Password</label>
                        <input type="password" class="form-input" id="new-password" placeholder="Leave blank to keep current" />
                    </div>
                    <div class="form-group">
                        <label>Confirm New Password</label>
                        <input type="password" class="form-input" id="confirm-password" placeholder="Confirm new password" />
                    </div>
                    <button type="button" class="btn-save" id="change-password-btn" style="background:var(--clay);">Update Password</button>
                </form>
            </div>

            <!-- Quick Links -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">Quick Links</span>
                </div>
                <div style="display:flex;flex-direction:column;gap:10px;">
                    <a href="experts.html" style="display:flex;align-items:center;gap:12px;padding:12px 14px;border:1px solid #edf4ed;border-radius:10px;font-size:0.88rem;font-weight:500;transition:box-shadow 0.2s;">
                        <span style="font-size:1.3rem;">üë©‚Äç‚öïÔ∏è</span>
                        <span>Find an Expert</span>
                        <span style="margin-left:auto;color:var(--muted);font-size:0.85rem;">‚Üí</span>
                    </a>
                    <a href="blog.html" style="display:flex;align-items:center;gap:12px;padding:12px 14px;border:1px solid #edf4ed;border-radius:10px;font-size:0.88rem;font-weight:500;transition:box-shadow 0.2s;">
                        <span style="font-size:1.3rem;">üìñ</span>
                        <span>Mental Health Articles</span>
                        <span style="margin-left:auto;color:var(--muted);font-size:0.85rem;">‚Üí</span>
                    </a>
                    <a href="games.html" style="display:flex;align-items:center;gap:12px;padding:12px 14px;border:1px solid #edf4ed;border-radius:10px;font-size:0.88rem;font-weight:500;transition:box-shadow 0.2s;">
                        <span style="font-size:1.3rem;">üéÆ</span>
                        <span>Mind Games</span>
                        <span style="margin-left:auto;color:var(--muted);font-size:0.85rem;">‚Üí</span>
                    </a>
                    <a href="sounds.html" style="display:flex;align-items:center;gap:12px;padding:12px 14px;border:1px solid #edf4ed;border-radius:10px;font-size:0.88rem;font-weight:500;transition:box-shadow 0.2s;">
                        <span style="font-size:1.3rem;">üéµ</span>
                        <span>Soothing Sounds</span>
                        <span style="margin-left:auto;color:var(--muted);font-size:0.85rem;">‚Üí</span>
                    </a>
                    <a href="crisis.html" style="display:flex;align-items:center;gap:12px;padding:12px 14px;border:1px solid #fff0ee;background:#fff8f5;border-radius:10px;font-size:0.88rem;font-weight:500;transition:box-shadow 0.2s;">
                        <span style="font-size:1.3rem;">üÜò</span>
                        <span>Crisis Resources</span>
                        <span style="margin-left:auto;color:var(--muted);font-size:0.85rem;">‚Üí</span>
                    </a>
                </div>
            </div>

        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <div class="crisis-banner" role="complementary">
        üÜò If you are in crisis, call or text <strong><a href="tel:988">988</a></strong> ¬∑ Text <strong>HOME</strong> to <strong>741741</strong> ¬∑ <a href="crisis.html">More resources ‚Üí</a>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const SUPABASE_URL = 'https://lxxtdlfgdcckjlbdleak.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx4eHRkbGZnZGNja2psYmRsZWFrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE3NTYwOTUsImV4cCI6MjA4NzMzMjA5NX0.wf81raVcsjeKbfoF6LGO71FxT_QpqptBWMIz7kteuf4';
        const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        function showToast(msg, isError = false) {
            const t = document.getElementById('toast');
            t.textContent = (isError ? '‚úó ' : '‚úì ') + msg;
            t.className = 'toast' + (isError ? ' error' : '');
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3500);
        }

        // ‚îÄ‚îÄ Auth gate ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        async function init() {
            const { data: { session }, error } = await sb.auth.getSession();

            if (!session) {
                window.location.replace('login.html');
                return;
            }

            const user = session.user;
            const meta = user.user_metadata || {};
            const fullName = meta.full_name || user.email.split('@')[0];
            const initials = fullName.split(' ').map(w => w[0]).join('').toUpperCase().slice(0,2);

            // Populate nav
            document.getElementById('nav-email').textContent = user.email;
            document.getElementById('nav-avatar').textContent = initials;

            // Populate welcome
            document.getElementById('user-name').textContent = fullName.split(' ')[0];

            // Populate settings
            document.getElementById('setting-name').value = fullName;
            document.getElementById('setting-email').value = user.email;

            // Hide loader
            document.getElementById('loading-screen').style.display = 'none';

            // Load saved articles
            loadSavedArticles(user.id);
        }

        // ‚îÄ‚îÄ Saved articles ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        async function loadSavedArticles(userId) {
            const container = document.getElementById('saved-articles-container');

            const { data, error } = await sb
                .from('saved_articles')
                .select('id, saved_at, blog_post_id')
                .eq('user_id', userId)
                .order('saved_at', { ascending: false })
                .limit(5);

            if (error || !data || data.length === 0) {
                // Show demo placeholder articles for a rich preview
                container.innerHTML = `
                    <div class="article-list">
                        <div class="article-item" onclick="window.location='blog-post.html'">
                            <div style="flex:1;">
                                <h4>How to Recognise and Break the Anxiety Cycle</h4>
                                <span class="article-tag">Anxiety &amp; Stress</span>
                                <p style="margin-top:5px;">Understanding the loop between anxious thoughts and physical tension ‚Äî and how to step out of it.</p>
                            </div>
                            <button class="article-unsave" title="Remove from saved">‚úï</button>
                        </div>
                        <div class="article-item" onclick="window.location='blog-post.html'">
                            <div style="flex:1;">
                                <h4>5 Signs You May Be Experiencing Burnout</h4>
                                <span class="article-tag">Work &amp; Burnout</span>
                                <p style="margin-top:5px;">Burnout goes beyond tiredness ‚Äî here are the key signals your mind and body are sending you.</p>
                            </div>
                            <button class="article-unsave" title="Remove from saved">‚úï</button>
                        </div>
                        <div class="article-item" onclick="window.location='blog-post.html'">
                            <div style="flex:1;">
                                <h4>What to Expect in Your First Therapy Session</h4>
                                <span class="article-tag">Therapy 101</span>
                                <p style="margin-top:5px;">First-timer's guide to what actually happens ‚Äî what to say, what not to worry about, and what's normal.</p>
                            </div>
                            <button class="article-unsave" title="Remove from saved">‚úï</button>
                        </div>
                    </div>`;

                // Update stat
                document.getElementById('stat-saved').textContent = '3';
                return;
            }

            document.getElementById('stat-saved').textContent = data.length;
            // In production this would join with blog_posts ‚Äî for now show count
            container.innerHTML = `<p style="font-size:0.88rem;color:var(--muted);text-align:center;padding:24px;">${data.length} article${data.length !== 1 ? 's' : ''} saved. <a href="blog.html" style="color:var(--sage-mid);text-decoration:underline;">Browse more ‚Üí</a></p>`;
        }

        // ‚îÄ‚îÄ Settings save ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        document.getElementById('settings-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('setting-name').value.trim();
            if (!name) return;

            const { error } = await sb.auth.updateUser({ data: { full_name: name } });
            if (error) {
                showToast(error.message, true);
            } else {
                showToast('Name updated successfully.');
                document.getElementById('user-name').textContent = name.split(' ')[0];
            }
        });

        // ‚îÄ‚îÄ Password change ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        document.getElementById('change-password-btn').addEventListener('click', async () => {
            const np = document.getElementById('new-password').value;
            const cp = document.getElementById('confirm-password').value;
            if (!np) { showToast('Enter a new password first.', true); return; }
            if (np.length < 8) { showToast('Password must be at least 8 characters.', true); return; }
            if (np !== cp) { showToast('Passwords do not match.', true); return; }

            const { error } = await sb.auth.updateUser({ password: np });
            if (error) {
                showToast(error.message, true);
            } else {
                showToast('Password updated. Stay safe!');
                document.getElementById('new-password').value = '';
                document.getElementById('confirm-password').value = '';
            }
        });

        // ‚îÄ‚îÄ Logout ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        document.getElementById('logout-btn').addEventListener('click', async () => {
            await sb.auth.signOut();
            window.location.href = 'index.html';
        });

        init();
    </script>

</body>
</html>
